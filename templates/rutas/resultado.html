{% extends "base.html" %}

{% block head_content %}

<title>Bienvenido a Movilízate</title>
{% load static %}
    <!-- Leaflet -->
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
    integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
    crossorigin=""></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
    integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
    crossorigin=""/>
    <!-- Extramarkers -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.0/leaflet.awesome-markers.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-extra-markers@1.0.6/dist/css/leaflet.extra-markers.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css">
    <!-- Estilos -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <!-- JS, Popper.js, and jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="{% static 'css/estilos.css' %} ">
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <script src="https://kit.fontawesome.com/ad8dd70d61.js" crossorigin="anonymous"></script>
    <!-- Sweet ALert -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
    <!-- Highlight -->
    <script src="{% static 'leaflet.marker.highlight/index.js'%}"></script>
    <link href="{% static 'leaflet.marker.highlight/index.css'%}" rel="stylesheet" >
    <!-- Routing -->
    <link rel="stylesheet" href="{% static 'js/routing/leaflet-routing-machine.css' %}">
    <!-- Geo Coding -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <!-- Side Bar -->
    <link rel="stylesheet" href="{% static 'sidebar-v2-master/css/leaflet-sidebar.css' %}">
    <!-- Control Bar -->
    <link rel="stylesheet" href="{% static 'leaflet-control-bar/src/L.Control.Bar.css' %}">
    <!-- Jquery UI -->
    <link rel="stylesheet" href="{% static 'jquery-ui-1.12.1/jquery-ui.js' %}">
    <!-- Google Icons  MD-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Search box -->
    <link href="{% static 'leaflet-custom-searchbox/dist/searchbox.min.css' %}" rel="stylesheet" />
    <!-- EStilos -->
    {% endblock%}        
    {% block container %}
    <!-- Sidebar -->
    <div id="sidebar" class="sidebar collapsed">
        <!-- Nav tabs -->
        <div class="sidebar-tabs">
            <ul role="tablist">
                <li><a href="#home" role="tab"><i class="fa fa-bars"></i></a></li>
                <li><a href="#profile" role="tab"><i class="fa fa-user"></i></a></li>
            </ul>

            <ul role="tablist">
                <li><a href="#settings" role="tab"><i class="fa fa-gear"></i></a></li>
            </ul>
        </div>

        <!-- Tab panes -->
        <div class="sidebar-content">
            <div class="sidebar-pane" id="home">
                <h1 class="sidebar-header">
                    Ruta
                    <span class="sidebar-close"><i class="fa fa-caret-left"></i></span>
                </h1>
                <div id="controls"></div>
    
            </div>

            <div class="sidebar-pane controls" id="profile">
                <h1 class="sidebar-header">Profile<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
            </div>

        </div>
    </div>
    <!-- Row para el mapa-->
    <div class="row">
        <div class="col" style="padding-right: -10px;">
            <div class="main-wrapper">
            <div id="bar">
                <!-- Row para las tarjetas -->
            <div class="row" id="" >
                <div class="col col-4 col-md-offset-2" id="res0" style="padding-left: 80px">        
                </div>
                <div class="col col-4 col-md-offset-2" id="res1" style="padding-left: 90px">        
                </div>
                <div class="col col-4 col-md-offset-2" id="res2" style="padding-left: 90px">        
                </div>
            </div>
            </div>
            <div id="myMap" class="sidebar-map" style="height: 1300px; width:1100px" style="padding-right: 0px;">
                <div class="overlay">
                    <input type="radio">Hola
                </div>
                <button id="refreshButton">Refresh Button</button>
            </div>
           
            </div>
        </div>
        </div>
    </div>
    
    <!-- Liberías: Leaflet, Enrutamiento, GeoJson dataset sidebar-->
    <script src="{% static 'sidebar-v2-master/js/leaflet-sidebar.js' %}"></script>
    <!-- Control bar -->
    <script src="{% static 'leaflet-control-bar/src/L.Control.Bar.js' %}"></script>
    <!-- Jquery UI -->
    <script src="{% static 'jquery-ui-1.12.1/jquery-ui.js' %}"></script>
    <!-- Search box -->
    <script src="{% static 'leaflet-custom-searchbox/dist/leaflet.customsearchbox.min.js'%}"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <script src="{% static 'js/leaflet.extra-markers.min.js' %}"></script>
    <script src="{% static 'js/routing/leaflet-routing-machine.min.js' %}"></script>
    <script src="{% static 'js/output.js' %}"></script>
    <script src="{% static 'js/script_blank.js'%}"></script>
    <script src="{% static 'js/movilizate.js' %}"></script>
    <script>
        //Control bar para activar contenedor de tarjetas
        var controlBar = L.control.bar('bar',{
            position:'bottom',
            visible:true
        });
        myMap.addControl(controlBar);

        //Inicio de sidebar
        var sidebar = L.control.sidebar('sidebar').addTo(myMap);
        //Verificación de la obtención del resultado de modelo 
        console.log({{ hcf|safe }})
        //Obtención de coordenadas
        
        console.log('Chi cheñol');
        //Importación de variables para correr 
        var latitude = "{{latitude}}";
        var longitude = "{{longitude}}";

        var hospitales = {{ hcf|safe }};
        var dlatitude = hospitales[0].LATITUD;
        var dlongitude = hospitales[0].LONGITUD;
        //Función de centrado
        center(latitude,longitude);
        Swal.fire({
            title: 'Listo!',
            text: 'Hemos encontrado opciones cerca de usted',
            icon: 'success',
            confirmButtonText: 'Continuar'
          });
    </script>
    <script>
        //Ciclo para colocar los íconos
        for (i=0;i<3;i++){
            var hospitales = {{ hcf|safe }};
            if(i==0){
            //Modificaciones aplicables para la primera opción
            mname = hospitales[i].NOMBRE_DE_LA_UNIDAD;
            mlatitude = hospitales[i].LATITUD;
            mlongitude = hospitales[i].LONGITUD;
            hospitalmarkerh(mlatitude,mlongitude);
            }
            else {
                //Para el resto
                mname = hospitales[i].NOMBRE_DE_LA_UNIDAD;
                mlatitude = hospitales[i].LATITUD;
                mlongitude = hospitales[i].LONGITUD;
                hospitalmarker(mlatitude,mlongitude); 
            }
        }
    </script>
      <!-- Script para mostrar la información de las tarjetas -->
    <script>
        var hospitales = {{ hcf|safe }};       
        for(i=0;i<3;i++){
            var nombre = hospitales[i].NOMBRE_DE_LA_UNIDAD;
            if(i==0){
                let tarjetas = `<div class="card card-hover border-0 rounded img-fluid position-relative zoom" style="border-radius:25px; height:400px; width:300px; padding-left:30px; padding-right:10px;  background-image: url('{% static 'img/green.png' %}'); max-height:400px; max-width:280px;" >
                    <div class="card-body" style="padding-top: -5px; z-index:2; position-absolute">
                    <div class="row t-info">
                        <div class="col-4"  >
                            <span class="fcircular" >
                            <img src="{% static 'img/descarga.png' %}" class="rounded-circle z-depth-2 shadow" height="55" width="55" alt="100x100" style="padding-bottom: 5px;">
                            </span>
                        </div>
                            <div class="col-8" padding-right="0">
                            
                            <div class="row"> 
                                <div class="col-3" style="color:white">3</h7></div>
                                <div class="col-9 d-flex justify-content-end" style="padding: top 25;">  
                                    <div class="row" style="padding-top: 4px;">
                                        <i class="fas fa-star" style="color:gold"></i>
                                        <i class="fas fa-star" style="color:gold"></i>
                                        <i class="fas fa-star" style="color:gold"></i>
                                        <i class="fas fa-star" style="color:grey"></i>
                                        <i class="fas fa-star" style="color:grey"></i>
                                    </div>  
                                </div>
                            </div>
                            <div class="row">
                            <h5 class="t-tarjeta" style="font-size: 15px; padding-left: 15px; padding-top:10px; color:white;">`+ nombre +`</h5>
                            </div>
                            </div>
                    </div>
                    <div class="row" style:padding-top:50px;>
                        <div class="col" style="max-height: 50px;">
                            <div class="tb-tarjeta rounded" style="background-color: #00d74e; ">
                                <h5 class="ct-tarjeta" style="font-size: 10px; text-align:center; color:white;" >Disponible en urgencias </h5>
                                <h5 class="ct-tarjeta" style="font-size: 10px; text-align:center; color:white;" >Servicio 24 horas</h5>
                                <h5 class="ct-tarjeta" style="font-size: 10px; text-align:center; color:white;" >Equipamento completo</h5>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col" style="padding-top: 20px; text-align:center;">
                            <button class="btn btn-light shadow" style="font-size: 10px; display:inline-block;">REGISTRAR EMERGENCIA</button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <ul style="padding-left: 0; padding-top:10px; ">
                                <li style="list-style-type: none;"><a href="" style="color: white; text-decoration:none;">ESPECIALIDADES</a></li>
                                <li style="list-style-type: none;"><a href="" style="color: white; text-decoration:none;">SERVICIOS</a></li>
                                <li style="list-style-type: none;"><a href="" style="color: white; text-decoration:none;">PRECIOS</a></li>
                                <li style="list-style-type: none;"><a href="" style="color: white; text-decoration:none;">CONTACTO</a></li>
                            </ul>
                        </div>
                    </div>
                    </div>
                </div>`;
                document.getElementById('res'+[i]).innerHTML= tarjetas;
            }
            else if (i == 1){
                let tarjetas = `<div class="card card-hover border-0 border-secondary rounded img-fluid position-relative zoom" style=" height:400px; width:300px; padding-left:30px; padding-right:10px;  background-image: url('{% static 'img/view.png' %}'); max-height:400px; max-width:280px;" >
                    <div class="card-body" style="padding-top: -5px; z-index:2; position-absolute">
                    <div class="row t-info">
                        <div class="col-4"  >
                            <span class="fcircular" >
                            <img src="{% static 'img/descarga.png' %}" class="rounded-circle z-depth-2 shadow" height="55" width="55" alt="100x100" style="padding-bottom: 5px;">
                            </span>
                        </div>
                            <div class="col-8" padding-right="0">
                            
                            <div class="row"> 
                                <div class="col-3" style="color:black">3</h7></div>
                                <div class="col-9 d-flex justify-content-end" style="padding: top 25;">  
                                    <div class="row" style="padding-top: 4px;">
                                        <i class="fas fa-star" style="color:gold"></i>
                                        <i class="fas fa-star" style="color:gold"></i>
                                        <i class="fas fa-star" style="color:gold"></i>
                                        <i class="fas fa-star" style="color:grey"></i>
                                        <i class="fas fa-star" style="color:grey"></i>
                                    </div>  
                                </div>
                            </div>
                            <div class="row">
                            <h5 class="t-tarjeta" style="font-size: 15px; padding-left: 15px; padding-top:10px; color:black;">`+ nombre +`</h5>
                            </div>
                            </div>
                    </div>
                    <div class="row">
                        <div class="col" style="max-height: 50px; padding-top:10px;">
                            <div class="tb-tarjeta rounded" style="background-color: #00d74e;">
                                <h5 class="ct-tarjeta" style="font-size: 10px; text-align:center; color:white;" >Disponible en urgencias </h5>
                                <h5 class="ct-tarjeta" style="font-size: 10px; text-align:center; color:white;" >Servicio 24 horas</h5>
                                <h5 class="ct-tarjeta" style="font-size: 10px; text-align:center; color:white;" >Equipamento completo</h5>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col" style="padding-top: 20px; text-align:center;">
                            <button class="btn btn-light shadow" style="font-size: 10px; display:inline-block;">REGISTRAR EMERGENCIA</button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <ul style="padding-left: 0; padding-top:10px; ">
                                <li style="list-style-type: none;"><a href="" style="color: black; text-decoration:none;">ESPECIALIDADES</a></li>
                                <li style="list-style-type: none;"><a href="" style="color: black; text-decoration:none;">SERVICIOS</a></li>
                                <li style="list-style-type: none;"><a href="" style="color: black; text-decoration:none;">PRECIOS</a></li>
                                <li style="list-style-type: none;"><a href="" style="color: black; text-decoration:none;">CONTACTO</a></li>
                            </ul>
                        </div>
                    </div>
                    </div>
                </div>`;
                document.getElementById('res'+[i]).innerHTML= tarjetas;
            }
            else{
                let tarjetas = `<div class="card card-hover border-0 border-secondary rounded img-fluid position-relative zoom" style=" height:400px; width:300px; padding-left:30px; padding-right:10px;  background-image: url('{% static 'img/selected.png' %}'); max-height:400px; max-width:280px;" >
                    <div class="card-body" style="padding-top: -5px; z-index:2; position-absolute">
                    <div class="row t-info">
                        <div class="col-4"  >
                            <span class="fcircular" >
                            <img src="{% static 'img/descarga.png' %}" class="rounded-circle z-depth-2 shadow" height="55" width="55" alt="100x100" style="padding-bottom: 5px;">
                            </span>
                        </div>
                            <div class="col-8" padding-right="0">
                            
                            <div class="row"> 
                                <div class="col-3" style="color:white">3</h7></div>
                                <div class="col-9 d-flex justify-content-end" style="padding: top 25;">  
                                    <div class="row" style="padding-top: 4px;">
                                        <i class="fas fa-star" style="color:gold"></i>
                                        <i class="fas fa-star" style="color:gold"></i>
                                        <i class="fas fa-star" style="color:gold"></i>
                                        <i class="fas fa-star" style="color:grey"></i>
                                        <i class="fas fa-star" style="color:grey"></i>
                                    </div>  
                                </div>
                            </div>
                            <div class="row">
                            <h5 class="t-tarjeta" style="font-size: 15px; padding-left: 15px; padding-top:10px; color:white;">`+ nombre +`</h5>
                            </div>
                            </div>
                    </div>
                    <div class="row">
                        <div class="col" style="max-height: 50px; padding-top:10px;">
                            <div class="tb-tarjeta rounded" style="background-color: #00d74e;">
                                <h5 class="ct-tarjeta" style="font-size: 10px; text-align:center; color:white;" >Disponible en urgencias </h5>
                                <h5 class="ct-tarjeta" style="font-size: 10px; text-align:center; color:white;" >Servicio 24 horas</h5>
                                <h5 class="ct-tarjeta" style="font-size: 10px; text-align:center; color:white;" >Equipamento completo</h5>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col" style="padding-top: 20px; text-align:center;">
                            <button class="btn btn-light shadow" style="font-size: 10px; display:inline-block;">REGISTRAR EMERGENCIA</button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <ul style="padding-left: 0; padding-top:10px; ">
                                <li style="list-style-type: none;"><a href="" style="color: white; text-decoration:none;">ESPECIALIDADES</a></li>
                                <li style="list-style-type: none;"><a href="" style="color: white; text-decoration:none;">SERVICIOS</a></li>
                                <li style="list-style-type: none;"><a href="" style="color: white; text-decoration:none;">PRECIOS</a></li>
                                <li style="list-style-type: none;"><a href="" style="color: white; text-decoration:none;">CONTACTO</a></li>
                            </ul>
                        </div>
                    </div>
                    </div>
                </div>`;
                document.getElementById('res'+[i]).innerHTML= tarjetas;
            }  
        }
    </script>
    <script>   
    </script>
    <script>
        //Enrutamiento
        var  control = L.Routing.control({
            router: L.routing.mapbox('pk.eyJ1IjoiaXRhc3RldGFjbyIsImEiOiJjazlyemdhMWQwMGw4M2VsaWk1YWNoZjE5In0.pOkmZhEiIga2RtfV0rpvqA'),
            //control.hide();,
            waypoints: [
                L.latLng(latitude,longitude),
                L.latLng(dlatitude,dlongitude)
            ],
            createMarker: function() { return null; },
            routeWhileDragging: true,
            geocoder: L.Control.Geocoder.nominatim()
        })
        .on('routesfound', function(e) {
            var routes = e.routes;
        });
        var routeBlock = control.onAdd(myMap);
        document.getElementById('controls').appendChild(routeBlock);
       // setTimeout(function(){
        //    location = ''
        //},000)
    </script>
    {% endblock %}
